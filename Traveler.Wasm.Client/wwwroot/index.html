<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kitchen Duplicate Traveler</title>
    <base href="/" />
    <link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />
    <link href="css/print.css" rel="stylesheet" media="print" />
    <script>
        console.log('🔍 DEBUG: index.html loaded');
        console.log('🔍 DEBUG: Base href:', document.querySelector('base').href);
        console.log('🔍 DEBUG: Current URL:', window.location.href);
        console.log('🔍 DEBUG: Origin:', window.location.origin);
        console.log('🔍 DEBUG: Pathname:', window.location.pathname);
    </script>
</head>

<body>
    <div id="app">
        <div style="position:absolute; top:30vh; width:100%; text-align:center">
            <p style="font-size:2rem"><em>Loading...</em></p>
            <p id="status-message" style="font-size:1rem; color: #666; margin-top: 20px;">Initializing...</p>
        </div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">🗙</a>
    </div>

    <script>
        console.log('🔍 DEBUG: About to load blazor.webassembly.js');
        console.log('🔍 DEBUG: Expected path:', document.querySelector('base').href + '_framework/blazor.webassembly.js');

        // Update status message
        function updateStatus(message) {
            const statusEl = document.getElementById('status-message');
            if (statusEl) {
                statusEl.textContent = message;
                console.log('📊 STATUS:', message);
            }
        }

        // Log when scripts start loading
        window.addEventListener('load', function () {
            console.log('✅ DEBUG: Window load event fired');
            updateStatus('Resources loaded, waiting for Blazor...');
        });

        // Catch any errors
        window.addEventListener('error', function (event) {
            console.error('❌ DEBUG: Error caught:', event.message);
            console.error('❌ DEBUG: Error source:', event.filename);
            console.error('❌ DEBUG: Error lineno:', event.lineno);
            console.error('❌ DEBUG: Error colno:', event.colno);
            console.error('❌ DEBUG: Error object:', event.error);
            updateStatus('ERROR: ' + event.message);
        });

        // Monitor resource loading
        window.addEventListener('load', function () {
            performance.getEntriesByType('resource').forEach(function (resource) {
                if (resource.name.includes('_framework') || resource.name.includes('_content')) {
                    console.log('📦 DEBUG: Resource loaded:', resource.name, 'Status:', resource.transferSize > 0 ? 'SUCCESS' : 'CACHED/FAILED');
                }
            });
        });

        // Hook into Blazor startup if available
        if (window.Blazor) {
            console.log('🔥 DEBUG: Blazor object exists before script load');
        }

        // Monitor for Blazor object creation
        let blazorCheckCount = 0;
        const blazorCheck = setInterval(function () {
            blazorCheckCount++;
            if (window.Blazor) {
                console.log('🔥 DEBUG: Blazor object detected after', blazorCheckCount, 'checks');
                updateStatus('Blazor object found, starting...');
                clearInterval(blazorCheck);
            } else if (blazorCheckCount > 50) {
                console.error('❌ DEBUG: Blazor object never appeared after 50 checks (5 seconds)');
                updateStatus('ERROR: Blazor failed to initialize');
                clearInterval(blazorCheck);
            }
        }, 100);

        // Check for WebAssembly support
        if (typeof WebAssembly === 'object') {
            console.log('✅ DEBUG: WebAssembly is supported');
            updateStatus('WebAssembly supported');
        } else {
            console.error('❌ DEBUG: WebAssembly is NOT supported in this browser');
            updateStatus('ERROR: WebAssembly not supported');
        }
    </script>

    <script src="_framework/blazor.webassembly.js" autostart="false"></script>
    <script>
        console.log('🔍 DEBUG: blazor.webassembly.js script tag processed');

        // Manually start Blazor with error handling
        setTimeout(function () {
            console.log('🚀 DEBUG: Attempting to start Blazor manually');

            if (window.Blazor) {
                console.log('🔥 DEBUG: Blazor object exists, calling start()');
                updateStatus('Starting Blazor...');

                Blazor.start().then(function () {
                    console.log('✅ DEBUG: Blazor.start() completed successfully');
                    updateStatus('Blazor started!');
                }).catch(function (error) {
                    console.error('❌ DEBUG: Blazor.start() failed:', error);
                    console.error('❌ DEBUG: Error stack:', error.stack);
                    updateStatus('ERROR: Blazor start failed - ' + error.message);
                });
            } else {
                console.error('❌ DEBUG: Blazor object not found, cannot start');
                updateStatus('ERROR: Blazor object not found');

                // Try to fetch blazor.boot.json to see if it's accessible
                fetch('_framework/blazor.boot.json')
                    .then(function (response) {
                        console.log('📋 DEBUG: blazor.boot.json response:', response.status);
                        return response.json();
                    })
                    .then(function (bootConfig) {
                        console.log('📋 DEBUG: blazor.boot.json content:', bootConfig);
                    })
                    .catch(function (error) {
                        console.error('❌ DEBUG: Failed to fetch blazor.boot.json:', error);
                    });
            }
        }, 1000);
    </script>

    <script src="_content/MudBlazor/MudBlazor.min.js"></script>
    <script>
        console.log('🔍 DEBUG: MudBlazor.min.js script tag processed');
    </script>
</body>

</html>